# 数据库系统
## 1. 数据库组成
一个完整的数据库大致由以下6个部分组成：
- 存储管理

管理具体数据的存储、索引等，通常采用 B+ 树存储。
- SQL 引擎

解析/优化 SQL 语句。
- 权限管理

管理数据库用户和角色权限。
- 事务管理

管理事务和隔离级别。
- 日志管理(用于恢复/回滚数据)

管理操作日志/数据日志的记录，也可以用来恢复/回滚数据。
- 客户端/服务端通信管理

管理客户端和数据库的交互，处理客户端请求。

由于一个数据库系统涉及的模块太多，这里只记录比较重要的模块。

### 1.1 客户端管理器
用于处理客户端通信。

客户端通过客户端管理器访问数据库，此时通常客户端管理器有以下作用：
* 调用权限管理验证客户端权限
* 管理客户端连接
* 接收 SQL 请求，并交给 SQL 引擎处理
* 将获取的结果集返回给客户端

### 1.2 SQL 引擎
一条 SQL 语句进入引擎会经过 `解析`、`重写`、`优化`、`编译`，最后才会执行。
- 解析

输入的是原始的 SQL 语句，输出的是解析后的内部表示（通常是一个树型结构）。

解析过程会进行一系列的检查：
* 关键字是否正确
* 语法是否正确
* 数据库表、字段是否存在
* 运算类型是否正确
* 是否有权限读取/写入数据
- 重写

重写会进行一些预优化：
* 视图合并，将视图转换为对应的 SQL 查询。
* 删除冗余的Join。
* 子查询扁平化，尝试移除子查询，合并到主查询中。
* 计算常数并赋值。
- 优化

通常使用的是基于成本的优化（CBO）。
最终生成一个相对较优的查询计划。
- 编译

将查询计划编译为可执行的代码。
- 执行

执行代码，与数据管理器交互，获取/写入数据。

# 数据库设计
## 1. 设计理论
### 1.1 名词解释
- Table（表）：数据库的数据的一个集合，由多个列和行组成，同一张表的数据共用同样的列。
- Attribute（属性）：表的列名。
- Tuple（元组）：表的一行数据。
- Domain（域）：属性的数据类型。
- Relation（依赖）：属性之间存在的某种联系。
- Schema（模式）：逻辑结构，属性在逻辑上组成的集合。
- Key（键）：由一个或多个属性组成的一个整体，通常是有唯一性的（即当两个元组的键相同，则其所有属性都相同）。一个属性可以存在于不同的键中，一张表也可以有多个键。
- Primary key（主键）：唯一性标识，不可为空，一个表中只能有一个主键。
- Candidate key（候选键）：由一个或多个属性组成的一个整体，具有主键的特征，都有资格成为主键。
- Super key（超键）：键的超集，包含键的属性集合。
- Foreign key（外键）：在关系 A 中的一个或多个属性在关系 B 中是一个 key，那么该属性集合在 A 中被称为外键。
- Prime attribute（主属性）：所有候选键里包含的属性都是主属性。
- Projection（投影）：
- Selection（选择）：按一定条件选择元组。
- Cross join（交叉连接）：又称笛卡尔积，将关系 A 和关系 B 中的每一行进行组合，保留所有组合结果。
- Natural join（自然连接）：将关系 A 和关系 B 中的每一行进行匹配，只保留相同的部分，去掉不匹配的部分。
- Theta join（θ连接）：又称连接，带约束条件的笛卡尔积。即在两个关系的笛卡尔积中根据条件过滤获取符合条件元组集合。
- Outer join（外连接）：自然连接时将不匹配的部分属性置为 null，并加入结果集。
- Division（除法运算）：关系 A 除以关系 B 得到结果 T，T 的属性是所有在 A 中但不在 B 中的属性集合，T 的元组包含了 A 所有元组和 B 所有的元组的一一组合。
### 1.2 函数依赖
在一个关系 R 中，属性组 A 的值由属性组 B 决定，即唯一确定的 B 能确定唯一的 A 值。

* 完全函数依赖：必须由完整的一组 B 属性才能决定 A。
* 部分函数依赖：B 中的部分属性也可以决定 A。
* 传递函数依赖：属性组 A 决定 B，B 决定 C，且同时满足，B/C 均不包含于 A，C 不包含于 B，B 不能决定 A，则说 C 传递依赖于 A。
### 1.3 异常和范式
#### 1.3.1 异常
不符合范式会造成异常。
以一张学生选课表为例：
学号, 姓名, 年龄, 课程名称, 成绩, 学分
* 数据冗余：同一个学生选修了 n 门课，则 (学号，姓名，年龄)在表中重复了 n 次。
* 修改异常：如果修改一门课的学分，那么要同时修改选了这门课的所有学生对应的元组的学分，否则或造成修改异常。
* 删除异常：如果删除一门课，那么要同时删除选了这门课所有学生对应的元组，否则会造成删除异常。
* 插入异常：插入一个元组，如果课程不存在，则会造成插入异常。

#### 1.3.2 1NF 第一范式
定义：属性不可分。
理解：一列只能表示单一的属性，不能把多种属性合并到一列。
实现方式：不用特地去实现，现代关系型数据库的表天然就是符合第一范式的，每个属性(列)只能使用一种类型。

#### 1.3.3 2NF 第二范式
定义：在满足 1NF 的前提下，每个非主属性都完全依赖于键码。
理解：在 1NF 的基础上，消除部分依赖。
实现方式：拆分表属性，还是以上述学生选课表为例：
(学号,课程名称) 是候选键，但是其中(学号)能决定(姓名,年龄)，同时(课程名称)能决定(学分)，有部分函数依赖。
实现 2NF 的方式是拆分表的属性，最后形成 3 张表：
学号，姓名，年龄

课程名称，学分

学号，课程名称，成绩

这样就消除了候选键的部分依赖，满足了 2NF。

但是结果的 3 张表依旧存在异常，


#### 1.3.4 3NF 第三范式
定义：在满足 2NF 的前提下，每个非主属性都不传递依赖于键码。
理解：在 2NF 的基础上，消除传递依赖。
实现方式：还是拆分表属性，以 2NF 拆分后的表为例，给课程表添加两个属性：教师，所属学院。

结果就是，所属学院传递依赖于课程名称，不符合 3NF。

可以将课程表进一步拆分为两个表：
课程名称，学分，教师

教师，所属学院

## 2. 设计流程
数据库的规范设计流程分为 6 个阶段：
- 需求分析：分析数据、功能、性能需求。

通常采用结构化分析方法（structured analysis），自顶向下，逐层分解分析系统。

分析的对象主要分为处理过程和数据。

对于处理过程，常用判定表或者判定树来描述。

对于数据，和处理过程同步，常用不同层次的数据流图表述。
- 概念结构设计：采用 E-R 模型设计概念结构，输出物为 E-R 图。
- 逻辑结构设计：将 E-R 图转换为数据库表结构，输出为数据库表。
- 数据库物理设计：为设计的数据库选择合适的物理存储结构和路径。

对数据库实际运行事务进行分析，选择合适的数据库存储结构。
常见的存储结构有：

    - 索引方法，主要是 B+ 树
    - 聚簇方法
    - hash 方法
- 数据库实施：编码，测试，试运行。
- 数据库运行与维护：正式运行数据库，以及在运行中维护数据库。

平时数据库设计最主要的工作内容在需求分析、概念结构设计和逻辑结构设计，即分析需求、画 E-R 图和根据 E-R 图建表。

### 2.1 E-R 图
Entity-Relationship（实体关系图）是用来描述关系型数据的重要手段，由3个部分组成：实体、属性、关系。

实体关系分为3种：
* 1 对 1
* 1 对 多
* 多 对 多

### 2.2 基于 E-R 图的数据库表结构设计
* 确定实体和关系
* 确定数据、属性
* 标准化数据
* 处理关系
* 检验设计

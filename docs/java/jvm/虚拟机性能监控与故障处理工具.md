# 虚拟机性能监控与故障处理工具
JDK 中bin目录下包含了许多工具，这些工具大多都由 tools.jar 中的功能封装得到。

## 1. 常用命令行工具
### 1.1 jps
功能类似 linux 的 ps，用于实时监控 JVM 进程信息。

#### 1.1.1 原理
JVM 启动后，会在 `java.io.tmpdir` 指定的临时文件目录下生成 `hsperfdata_{userName}` 文件夹，里面文件的名字就进程 pid，因此 jps 实际上就是列出这几个文件，或者根据参数解析显示这些文件里的对应信息。

#### 1.1.2 命令格式
```
jps [option] [hostid]
```
`hostid` 为 RMI 注册表中注册的主机名称，使用这个参数来查看远程虚拟机进程信息。

#### 1.1.3 参数选项
常用 option：
|option|功能|
|---|---|
|-l|输出完全的包名，应用主类名，如果执行的是 jar 包，输出jar包全路径名|
|-q|只输出 LVMID|
|-m|输出启动时传给 main 方法的参数|
|-v|输出虚拟机参数|

### 1.2 jstat
虚拟机统计信息监视工具，用于统计、监控虚拟机的运行状态。可以输出本地或远程虚拟机进程中的内存、垃圾收集、类装载、JIT相关信息等。

#### 1.2.1 命令格式
```
jstat [option vmid [interval [s | ms] [count]]]
```

需要注意后两个参数：
* `interval` 表示查询间隔
* `count` 表示查询次数

比如:
> jstat -gc 27464 500 20

表示每 500 毫秒输出一次 27464 虚拟机进程的垃圾回收状态，总共查询 20 次。

#### 1.2.2 参数选项
常用 option：
|option|功能|
|---|---|
|-class|显示类装载、卸载数量、总空间、类装载所耗费的时间|
|-gc|显示堆的状态|
|-gcutil|监控内容和 `-gc` 基本相同，但是显示的是已使用空间占总空间的百分比|
|-compiler|显示 JIT 编译器编译过的方法、耗时等信息|

最常用的是 `-gcutil`，大多数情况下排查内存相关问题会先用这个查看当前环境虚拟机堆的状态。

但如果环境可以导出 heapdump，那还是更推荐使用 VisualVM 等可视化工具分析堆状态。

### 1.3 jinfo
实时查看虚拟机启动参数（包括默认的未显式指定的参数），实时修改部分运行参数。

#### 1.3.1 

## 2. 常用可视化工具
## 3. 常用第三方工具
